<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WILD ROCKER â€” Secure Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root{
  --bg:#020204;
  --neon:#39ff14;
  --muted:#7f8f7f;
  --panel:rgba(0,0,0,0.55);
}
body{
  background:var(--bg);
  color:var(--neon);
  font-family:"Courier New", monospace;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
.navbar{
  background:rgba(0,0,0,0.6);
  border-bottom:1px solid rgba(57,255,20,0.2);
  box-shadow:0 0 20px rgba(57,255,20,0.15);
}
.navbar-brand{
  color:var(--neon)!important;
  font-weight:700;
  text-shadow:0 0 8px rgba(57,255,20,0.4);
}
.logout-btn{
  border:1px solid rgba(57,255,20,0.3);
  color:var(--neon);
  background:transparent;
  border-radius:8px;
  padding:8px 18px;
  transition:0.2s;
}
.logout-btn:hover{ background:rgba(57,255,20,0.15); }

.dashboard{
  flex:1;
  padding:40px 20px;
  display:flex;
  flex-direction:column;
  align-items:center;
}

h1{
  font-size:2rem;
  text-shadow:0 0 10px rgba(57,255,20,0.4);
  margin-bottom:5px;
}
#roleText{
  color:var(--muted);
  font-size:0.9rem;
}
.status-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:20px;
  width:100%;
  max-width:1100px;
  margin-top:30px;
}
.status-card{
  background:var(--panel);
  border:1px solid rgba(57,255,20,0.1);
  border-radius:12px;
  padding:20px;
  box-shadow:0 0 20px rgba(57,255,20,0.06);
  transition:0.3s;
}
.status-card:hover{
  box-shadow:0 0 30px rgba(57,255,20,0.3);
  transform:translateY(-3px);
}
.status-title{ color:var(--muted); font-weight:bold; font-size:0.9rem; }
.status-value{
  font-size:1.4rem;
  color:var(--neon);
  margin-top:6px;
  text-shadow:0 0 10px rgba(57,255,20,0.3);
}
.ticker{
  background:rgba(0,0,0,0.55);
  color:var(--muted);
  font-size:0.82rem;
  border-top:1px solid rgba(57,255,20,0.1);
  padding:6px 0;
  overflow:hidden;
  white-space:nowrap;
}
.ticker span{
  display:inline-block;
  padding-left:100%;
  animation:ticker-scroll 25s linear infinite;
}
@keyframes ticker-scroll{
  0%{transform:translateX(0);}
  100%{transform:translateX(-100%);}
}
footer{
  text-align:center;
  color:var(--muted);
  font-size:0.85rem;
  padding:10px 0;
}

/* Chat section */
.chat-section{
  margin-top:40px;
  width:100%;
  max-width:900px;
  background:var(--panel);
  border-radius:12px;
  border:1px solid rgba(57,255,20,0.1);
  padding:20px;
}
.chat-header{
  font-weight:700;
  margin-bottom:10px;
  text-shadow:0 0 6px rgba(57,255,20,0.3);
}
.chat-box{
  height:300px;
  overflow-y:auto;
  background:rgba(0,0,0,0.3);
  border-radius:8px;
  padding:12px;
  font-size:0.9rem;
}
.msg{
  margin-bottom:10px;
  padding:6px 10px;
  border-radius:6px;
}
.msg.you{ background:rgba(57,255,20,0.1); text-align:right; }
.msg.other{ background:rgba(255,255,255,0.05); }
.chat-input{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.chat-input input, .chat-input select{
  background:transparent;
  border:1px dashed rgba(57,255,20,0.15);
  color:var(--neon);
  border-radius:8px;
  height:42px;
  padding:0 10px;
  flex:1;
}
.chat-input button{
  border:1px solid rgba(57,255,20,0.3);
  background:transparent;
  color:var(--neon);
  border-radius:8px;
  height:42px;
  width:120px;
}
.chat-input button:hover{ background:rgba(57,255,20,0.1); }
</style>
</head>

<body>
<nav class="navbar navbar-dark">
  <div class="container-fluid">
    <span class="navbar-brand">âš¡ WILD ROCKER :: DASHBOARD</span>
    <button id="logoutBtn" class="logout-btn">Logout</button>
  </div>
</nav>

<div class="dashboard">
  <h1 id="welcomeText">Welcome, Operator</h1>
  <p id="roleText">Access Level: --</p>
  <p style="color:var(--muted);font-size:0.9rem;" id="dateTime"></p>

  <div class="status-grid">
    <div class="status-card"><div class="status-title">System Health</div><div class="status-value" id="sysHealth">âœ… Stable</div></div>
    <div class="status-card"><div class="status-title">Active Users</div><div class="status-value" id="activeUsers">--</div></div>
    <div class="status-card"><div class="status-title">Firewall Status</div><div class="status-value" id="firewall">--</div></div>
    <div class="status-card"><div class="status-title">Server Load</div><div class="status-value" id="serverLoad">--</div></div>
    <div class="status-card"><div class="status-title">Last Backup</div><div class="status-value" id="lastBackup">--</div></div>
    <div class="status-card"><div class="status-title">Threat Level</div><div class="status-value" id="threatLevel">--</div></div>
  </div>

  <!-- CHAT SYSTEM -->
  <div class="chat-section mt-4">
    <div class="chat-header">ðŸ’¬ Secure Node Chat</div>
    <div class="chat-box" id="chatBox"></div>
    <div class="chat-input">
      <select id="chatTo">
        <option value="admin0">admin0</option>
        <option value="operator">operator</option>
        <option value="guest">guest</option>
      </select>
      <input id="chatText" type="text" placeholder="Type your message..." />
      <button id="sendBtn">Send</button>
    </div>
  </div>
</div>

<div class="ticker">
  <span>[SYS] Monitoring node activity â€” [FIREWALL] No intrusions detected â€” [SYNC] Backup completed â€” [NETWORK] 99.98% uptime â€” [SECURITY] Crypto modules active â€” </span>
</div>

<footer>Â© 2025 WILD ROCKER Systems | Secure Node v2.1</footer>

<script>
/* ----------------- CONFIG ----------------- */
const SHEET_ENDPOINT = "https://script.google.com/macros/s/AKfycbwthlxHJOMi1c8tA1sp-oMFNtnBVupszWLqmnS1xd5JWx5_G2IBwKwOK2kfSjtBMyNRqg/exec";

// For chat, replace with your Apps Script endpoints (read/write)
const CHAT_WRITE_URL = "YOUR_POST_CHAT_URL";
const CHAT_READ_URL = "YOUR_GET_CHAT_URL";

/* ----------------- AUTH + USER ----------------- */
const user = sessionStorage.getItem("user");
if(!user){ window.location.href = "index.html"; }

async function fetchUserData(){
  try{
    const res = await fetch(SHEET_ENDPOINT);
    const data = await res.json();
    const found = data.find(r=>String(r.Username||r.username)==user);
    if(found){
      const name = found.Name || found.FullName || user;
      const role = found.Role || "user";
      sessionStorage.setItem("name", name);
      document.getElementById("welcomeText").textContent = `Welcome, ${name}`;
      document.getElementById("roleText").textContent = `Access Level: ${role}`;
    } else {
      document.getElementById("welcomeText").textContent = `Welcome, ${user}`;
    }
  }catch(e){ console.error("Sheet fetch failed",e); }
}
fetchUserData();

/* ----------------- TIME + METRICS ----------------- */
function updateTime(){
  document.getElementById("dateTime").textContent = new Date().toLocaleString();
}
setInterval(updateTime,1000); updateTime();

function randomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function updateMetrics(){
  document.getElementById("activeUsers").textContent = randomInt(4,18);
  document.getElementById("serverLoad").textContent = randomInt(10,92)+"%";

  const fireStates=["ðŸŸ¢ Engaged","ðŸŸ¡ Monitoring","ðŸ”´ Rebooting"];
  document.getElementById("firewall").textContent = fireStates[randomInt(0,fireStates.length-1)];

  const threats=["Low","Moderate","Elevated","High","Critical"];
  const t = threats[randomInt(0,threats.length-1)];
  document.getElementById("threatLevel").textContent = t;
  document.getElementById("threatLevel").style.color = (t==="High"||t==="Critical")?"#ff4b4b":(t==="Elevated"?"#f6ff4b":"#39ff14");

  const hrs=randomInt(0,12), mins=randomInt(0,59);
  document.getElementById("lastBackup").textContent = `${hrs}h ${mins}m ago`;

  const sysStates=["âœ… Stable","ðŸŸ¢ Optimal","âš ï¸ Degraded","ðŸŸ¥ Failure"];
  document.getElementById("sysHealth").textContent = sysStates[randomInt(0,sysStates.length-1)];
}
updateMetrics();
setInterval(updateMetrics,6000);

/* ----------------- LOGOUT ----------------- */
document.getElementById("logoutBtn").addEventListener("click",()=>{
  sessionStorage.clear();
  window.location.href="index.html";
});

/* ----------------- CHAT SYSTEM ----------------- */
const chatBox = document.getElementById("chatBox");
const chatText = document.getElementById("chatText");
const chatTo = document.getElementById("chatTo");
const sendBtn = document.getElementById("sendBtn");
const username = sessionStorage.getItem("name") || user;

function renderChat(data){
  chatBox.innerHTML="";
  data.slice(-50).forEach(r=>{
    const [time,sender,recipient,msg]=r;
    const div=document.createElement("div");
    div.className="msg "+(sender===username?"you":"other");
    div.textContent=`${sender}: ${msg}`;
    chatBox.appendChild(div);
  });
  chatBox.scrollTop=chatBox.scrollHeight;
}

async function loadChat(){
  try{
    const res = await fetch(CHAT_READ_URL+"?t="+Date.now());
    const data = await res.json();
    renderChat(data);
  }catch(e){console.error("Chat read failed",e);}
}
async function sendChat(){
  const msg = chatText.value.trim();
  if(!msg) return;
  const payload = {sender:username, recipient:chatTo.value, message:msg};
  chatText.value="";
  try{
    await fetch(CHAT_WRITE_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
    loadChat();
  }catch(e){console.error("Chat send failed",e);}
}
sendBtn.addEventListener("click",sendChat);
chatText.addEventListener("keypress",e=>{if(e.key==="Enter")sendChat();});
setInterval(loadChat,5000);
loadChat();
</script>
</body>
</html>
